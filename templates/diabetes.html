<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diabetes Predictor</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='stylesheet.css') }}">
</head>
<body>
  <!-- Overlay for readability -->
  <div class="overlay"></div>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="logo">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
    </div>
    <ul class="nav-links">
      <li><a href="/aboutUs">About Us</a></li>
      <li><a href="/contactUs">Contact Us</a></li>
      <li><a href="/logout">Logout</a>
    </ul>
  </nav>

  <!-- Username under navbar -->
  <div class="welcome-container">
    <span class="welcome-text">WELCOME: {{ session['username'] }}</span>
  </div>

  <!-- Prediction Section -->
  <section class="landing">
    <div class="content">
      <h1>DIABETES PREDICTOR</h1>
      <form id="predictForm" onsubmit="process(); return false;">
    <label>Gender:</label>
    <select name="gender" required>
        <option value="">Select Gender</option>
        <option value="1">Female</option>
        <option value="0">Male</option>
    </select>

    <label>Age:</label>
    <input type="number" name="age" placeholder="Enter Your Age (1 to 99)" required>

    <label>Hypertension:</label>
    <select name="hypertension" required>
        <option value="">Select</option>
        <option value="1">Yes</option>
        <option value="0">No</option>
    </select>

    <label>Heart Disease:</label>
    <select name="heartdisease" required>
        <option value="">Select</option>
        <option value="1">Yes</option>
        <option value="0">No</option>
    </select>

    <label>Smoking History:</label>
    <select name="smokinghistory" required>
        <option value="">Select</option>
        <option value="0">No Info</option>
        <option value="1">Current</option>
        <option value="2">Ever</option>
        <option value="3">Former</option>
        <option value="4">Never</option>
        <option value="5">Not Current</option>
    </select>

    <label>BMI Level:</label>
    <input type="number" step="0.1" name="bmi" placeholder="BMI" required>

    <label>HbA1c Level:</label>
    <input type="number" step="0.1" name="HbA1c_level" placeholder="HbA1c" required>

    <label>Blood Glucose Level:</label>
    <input type="number" name="bloodglucoselevel" placeholder="Blood Glucose Level" required>

    <button type="submit" class="btn">Predict</button>
</form>

      <div id="prediction" style="margin-top:20px; font-weight:bold;"></div>
    </div>

    <div class="image-container">
      <img src="{{ url_for('static', filename='diabetes.png') }}" alt="Diabetes Device">
    </div>
  </section>

  <!-- JS -->
  <script>
    function form_handler(event) {
      event.preventDefault();
    }

    function process() {
      document.querySelector("#predictForm").addEventListener("submit", form_handler);
      var data = new FormData(document.querySelector('#predictForm'));

      var xhr = new XMLHttpRequest();
      xhr.open("POST", "/diabetesPrediction", true);
      document.getElementById("prediction").innerHTML = "Wait! Predicting Result...";

      xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            if (xhr.responseText.trim() === "1") {
              let text = "<span style='color: blue;'>PLEASE CONSULT WITH DOCTOR</span>";
              let result = text.link("/dconsult");
              document.getElementById("prediction").innerHTML =
                "<span style='color: green;'>PREDICTION: POSITIVE!!<br></span>" + result;
            } else if (xhr.responseText.trim() === "0") {
              document.getElementById("prediction").innerHTML =
                "<span style='color: red;'>PREDICTION: NEGATIVE!!<br></span>DONT WORRY YOU ARE HEALTHY";
            } else {
              document.getElementById("prediction").innerHTML = "Unexpected response: " + xhr.responseText;
            }
          } else {
            document.getElementById("prediction").innerHTML = "Error contacting server!";
          }
        }
      }
      xhr.send(data);
    }
  </script>
</body>
</html>
